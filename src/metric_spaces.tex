\section{Metric spaces}\label{sec:metric_spaces}

\begin{definition}\label{def:metric_space}\cite[248]{Engelking1989}
  A \ul{metric space} is a set $X$ along with a function $\mu: X \times X \to \BB{R}^{\geq 0}$, called a \ul{metric} or \ul{distance function}, such that
  \begin{description}
    \DItem{identity}{def:metric_space/identity} $\mu(x, y) = 0 \iff x = y$
    \DItem{symmetry}{def:metric_space/symmetry} $\mu(x, y) = \mu(y, x)$
    \DItem{triangle inequality}{def:metric_space/triangle_inequality} $\mu(x, y) \leq \mu(x, z) + \mu(z, y)$
  \end{description}

  If instead of \ref{def:metric_space/identity} we have the weaker condition
  \begin{description}
    \DItem{pseudometric identity}{def:metric_space/pseudometric_identity} $\forall x \in X, \mu(x, x) = 0$,
  \end{description}
  we call $\mu$ a \ul{pseudometric} and $(X, \mu)$ a \ul{pseudometric space}.

  \begin{defenum}
    \item\label{def:metric_space/subspace} If $A \subseteq X$ is a set, then $(A, \mu{\restriction_A})$ is a metric space and is called a \ul{subspace}.

    \item\label{def:metric_space/ball} Define the function
    \begin{align*}
      &B: X \times \BB{R}^{>0} \to \Power(X), \\
      &B(x, r) \coloneqq \{ y \in X \colon \mu(x, y) = r \}.
    \end{align*}

    The set $B(x, r)$ is called a \ul{ball with center $x$ and radius $r$}.

    \item\label{def:metric_space/closed_ball} The set
    \begin{align*}
      \Ol{B(x, r)} \coloneqq \Cl(B(x, r))
    \end{align*}
    is called the \ul{closed ball with center $x$ and radius $r$}.

    \item\label{def:metric_space/closed_ball} The set
    \begin{align*}
      S(x, r) \coloneqq \partial{B(x, r)}
    \end{align*}
    is called the \ul{sphere with center $x$ and radius $r$}.

    \item\label{def:metric_space/bounded_set} A set $A \subseteq X$ is called \ul{bounded} if it is contained in some ball $B(x, r)$.

    \item\label{def:metric_space/bounded_sequence} A sequence\Tinyref{def:sequence} $\{ x_i \}_{i=1}^\infty \subseteq X$ is called \ul{bounded} if the corresponding set $\{ x_i \colon i = 1, 2, \ldots \}$ is bounded\Tinyref{def:metric_space/bounded_set}.

    \item\label{def:metric_space/bounded_metric} If every set is bounded, we say that the metric itself is bounded.

    \item\label{def:metric_space/diameter} Define the partial\Tinyref{def:function/partial} function
    \begin{align*}
      &\Diam: \Power(X) \to \BB{R}^{\geq 0}, \\
      &\Diam(A) \coloneqq \sup \{ \mu(x, y) \colon x, y \in A \}.
    \end{align*}

    If it exists, we call the number $\Diam(A)$ the \ul{diameter of $A$}.

    \item\label{def:metric_space/distance} Define the function
    \begin{align*}
      &\Dist: X \times \Power(X) \to \BB{R}^{\geq 0}, \\
      &\Dist(x, A) \coloneqq \inf \{ \mu(x, a) \colon a \in A \}.
    \end{align*}

    We call the number $\Dist(x, A)$ the \ul{distance from the point $x$ to the set $A$}. We use the convention that the infimum of an empty set of real numbers is $+\infty$, hence $\Dist(x, \varnothing) = \infty$.
  \end{defenum}
\end{definition}

\begin{note}\label{note:bounded_set_metric_order_equivalence}
  A set $A$ in a metric space $(X, \mu)$ is bounded\Tinyref{def:metric_space/bounded_set} if and only if the set $\{ \mu(a, b) \colon a, b \in A \}$ is bounded as a poset\Tinyref{def:poset/bounded_set}.
\end{note}

\begin{definition}\label{def:metric_topology}\cite[249]{Engelking1989}
  Let $(X, \mu)$ be a metric space. We define the \ul{metric topology} or \ul{induced topology} $\Cal{T}$ as the topology\Tinyref{def:topological_space} generated by the neighborhood system\Tinyref{def:topological_local_base}
  \begin{align*}
    \Cal{B}(x) \coloneqq \{ B (x, r) \colon r \in \BB{R}^{>0} \}.
  \end{align*}

  If for some topological space $(X, \Cal{T})$ there exists a metric such that $\Cal{T}$ is its induced topology, we say that the topology $\Cal{T}$ is \ul{metrizable}.
\end{definition}
\begin{proof}
  This is indeed a neighborhood system as it satisfies \ref{thm:topological_local_base_axioms/BP1}-\ref{thm:topological_local_base_axioms/BP3}:

  \begin{description}
    \item[\ref{thm:topological_local_base_axioms/BP1}] Every point $x$ belongs to any ball centered at $x$.

    \item[\ref{thm:topological_local_base_axioms/BP2}] Fix $x \in X$ and two balls $B(x, r)$ and $B(x, s)$. Then
    \begin{align*}
      B(x, \min\{ r, s \}) \subseteq B(x, r) \cap B(x, s).
    \end{align*}

    \item[\ref{thm:topological_local_base_axioms/BP3}] Fix $x, y \in X$ and let $x \in B(y, r)$, i.e. $\mu(x, y) < r$.

    Define
    \begin{align*}
      s \coloneqq \min\{ \mu(x, y), \frac 1 n - \mu(x, y) \}.
    \end{align*}

    Let $z \in B(x, s)$. There are two cases:
    \begin{itemize}
      \item if $\mu(x, y) \leq \tfrac r 2$, then
      \begin{align*}
        \mu(z, y)
        \leq
        \mu(z, x) + \mu(x, y)
        <
        s + \mu(x, y)
        \leq
        \mu(x, y) + \mu(x, y)
        \leq
        2 \tfrac r 2
        =
        r.
      \end{align*}

      \item if $\mu(x, y) > \tfrac r 2$, then
      \begin{align*}
        \mu(z, y)
        \leq
        \mu(z, x) + \mu(x, y)
        <
        s + \mu(x, y)
        \leq
        (r - \mu(x, y)) + \mu(x, y)
        =
        r.
      \end{align*}
    \end{itemize}

    In both cases, $B(x, s) \subseteq B(y, r)$.

    \begin{center}
      \begin{tikzpicture}
        \filldraw (0.5, 0.5) circle (0.05) node[right] {$x$};
        \draw (0.5, 0.5) circle (0.707);

        \filldraw (0, 0) circle (0.05) node[left] {$y$};
        \draw (0, 0) circle (2);
      \end{tikzpicture}
      \begin{tikzpicture}
        \filldraw (1, 1) circle (0.05) node[right] {$x$};
        \draw (1, 1) circle (0.59);

        \filldraw (0, 0) circle (0.05) node[left] {$y$};
        \draw (0, 0) circle (2);
      \end{tikzpicture}
    \end{center}
  \end{description}
\end{proof}

\begin{proposition}\label{thm:locally_countable_metric_topology}
  The following is an alternative base for the metric topology\Tinyref{def:metric_topology}:

  \begin{align*}
    \Cal{B}(x) \coloneqq \{ B (x, \tfrac 1 n) \colon n = 1, 2, 3, \ldots \}.
  \end{align*}
\end{proposition}
\begin{proof}
  The proof is the same as in \cref{def:metric_topology}, except for a slight tweak in \ref{thm:topological_local_base_axioms/BP3}, where we define $m$ to be the the smallest positive integer such that
  \begin{align*}
    \tfrac 1 m \leq \min\{ \mu(x, y), r - \mu(x, y) \}.
  \end{align*}

  Note that $m$ exists by \cref{thm:ordinals_are_well_ordered}.

  We then obtain $B(x, \tfrac 1 m) \subseteq B(y, \tfrac 1 n)$.
\end{proof}

\begin{proposition}\label{thm:metric_topology_properties}
  The metric topology $\Cal{T}$ on $X$ induced by $\mu$ has the following properties:
  \begin{defenum}
    \item\label{thm:metric_topology_properties/ball_is_open} For every point $x \in X$ and any radius $r > 0$, the ball $B(x, r)$ is an open set and, hence, a neighborhood of $x$.
    \item\label{thm:metric_topology_properties/first_countable} $\Cal{T}$ is first-countable.
    \item\label{thm:metric_topology_properties/hausdorff} $\Cal{T}$ is Hausdorff.
  \end{defenum}
\end{proposition}
\begin{proof}
  \begin{description}
    \item[\ref{thm:metric_topology_properties/ball_is_open}] Obvious from \cref{def:metric_topology}.

    \item[\ref{thm:metric_topology_properties/first_countable}] Since \cref{thm:locally_countable_metric_topology} involves generating a topology using a neighborhood system of countable local neighborhoods, $\Cal{T}$ is first-countable.

    \item[\ref{thm:metric_topology_properties/hausdorff}] Let $x, y \in X$ be distinct points. Define
    \begin{align*}
      r \coloneqq \dfrac 1 2 \mu(x, y),
    \end{align*}
    so that
    \begin{align*}
      B(x, r) \cap B(y, r) = \varnothing.
    \end{align*}
  \end{description}
\end{proof}

\begin{proposition}\label{thm:metric_convergence_iff_metric_topology_convergence}
  Let $(X, \mu)$ be a metric space and $\Cal{T}$ be the induced metric topology\Tinyref{def:metric_topology}. The convergence\Tinyref{sec:convergence} in $\Cal{T}$ is the completely described by sequences, that is,

  \begin{defenum}
    \item\label{thm:metric_convergence_iff_metric_topology_convergence/single_limit} every converging net\Tinyref{def:topological_net} has a single limit.

    \item\label{thm:metric_convergence_iff_metric_topology_convergence/cluster_point} $x \in X$ is a cluster point\Tinyref{def:net_cluster_point} of the sequence $\{ x_i \}_{i=1}^\infty$ if and only if for every positive real number $\varepsilon > 0$ and every index $i_0$ there exists an index $i_\varepsilon > i_0$ such that
    \begin{align*}
      \mu(x, x_{i_\varepsilon}) < \varepsilon.
    \end{align*}

    \item\label{thm:metric_convergence_iff_metric_topology_convergence/limit_point} $x \in X$ is a limit point\Tinyref{def:net_limit_point} of the sequence $\{ x_i \}_{i=1}^\infty$ if and only if for every positive real number $\varepsilon > 0$ there exists an index $i_0$ such that
    \begin{align*}
      i \geq i_0 \implies \mu(x, x_i) < \varepsilon.
    \end{align*}

    \item\label{thm:metric_convergence_iff_metric_topology_convergence/closure} given any set $A \subseteq X$, a point $x \in X$ belongs to $\Cl{A}$ if and only if there exists a sequence $\{ x_i \}_{i=1}^\infty \subseteq A$ such that $x_i \xrightarrow[i \to \infty]{} x$ (compare with \cref{thm:limit_point_iff_in_closure}).
  \end{defenum}
\end{proposition}
\begin{proof}
  \begin{description}
    \item[\ref{thm:metric_convergence_iff_metric_topology_convergence/single_limit}] Follows directly from \cref{thm:t2_iff_singleton_limits} and \cref{thm:metric_topology_properties/hausdorff}.

    \item[\ref{thm:metric_convergence_iff_metric_topology_convergence/cluster_point}] Fix a sequence $x_i \to x$.

    \Implies Fix a radius $\varepsilon > 0$ and an index $i_0$. Note that $B(x, \varepsilon)$ is a neighborhood of $x$ and hence by \cref{def:net_cluster_point} there exists an index $i_\varepsilon \geq i_0$ such that $x_{i_U} \in B(x, \varepsilon)$, which is the same as
    \begin{align*}
      \mu(x, x_{i_U}) < \varepsilon.
    \end{align*}

    \ImpliedBy Fix a neighborhood $U$ of $x$. Since the topology is generated by a local base of balls, then $U$ contains some ball $B(x, r)$. Thus there exists an index $i_0$, such that
    \begin{align*}
      \mu(x, x_{i_r}) < r,
    \end{align*}
    hence
    \begin{align*}
      x_{i_r} \in B(x, r) \subseteq U.
    \end{align*}

    \item[\ref{thm:metric_convergence_iff_metric_topology_convergence/limit_point}] Similar to \ref{thm:metric_convergence_iff_metric_topology_convergence/cluster_point}.

    \item[\ref{thm:metric_convergence_iff_metric_topology_convergence/closure}]
    \Implies Fix a nonempty set $A$ and $x \in \Cl A$. If $x \in A$, then the constant sequence with all members equal to $x$ converges to $A$.

    Assume that $x \not\in A$ and choose any sequence\AOC
    \begin{align*}
      x_i \in B(x, \tfrac 1 i) \setminus \{ x \}, i = 1, 2, \ldots.
    \end{align*}

    Fix $\varepsilon > 0$. By \cref{thm:ordinals_are_well_ordered} there exists a least positive integer $i_0$ such that $\tfrac 1 i_0 < \varepsilon$. It follows that $x_i \to x$ since
    \begin{align*}
      i \geq i_0 \implies \mu(x, x_i) \leq \mu(x, x_{i_0}) \leq \varepsilon.
    \end{align*}

    \ImpliedBy Obvious
  \end{description}
\end{proof}

\begin{definition}\label{def:isometry}\cite[253]{Engelking1989}
  Let $(X, \mu)$ and $(Y, \nu)$ be two metric spaces\Tinyref{def:metric_space}. We say that the function $f: X \to Y$ is a \ul{distance preserving map} or \ul{isometry} or \ul{isometric embedding} if
  \begin{align*}
    \forall x, y \in X, \mu(x, y) = \nu(f(x), f(y)).
  \end{align*}

  If $f$ is bijective, we say that $X$ and $Y$ are \ul{isometric}.
\end{definition}

\begin{proposition}\label{def:isometry_is_injective}
  An isometry\Tinyref{def:isometry} $f: (X, \mu) \to (Y, \nu)$ is always injective.
\end{proposition}
\begin{proof}
  If\LEM $f(x) = f(x')$, then by \ref{def:metric_space/identity}, $x = x'$.
\end{proof}

\begin{definition}\label{def:category_of_metric_spaces}
  The class\Tinyref{def:set_zfc} of all metric spaces forms the category\Tinyref{def:category} $\Bold{Met}$, where for every two metric spaces $X, Y \in \Bold{Met}$, the morphisms $\Bold{Met}(X, Y)$ are the isometries\Tinyref{def:isometry} from $X$ to $Y$ and composition is the usual function composition\Tinyref{def:function_composition}.

  The category is concrete\Tinyref{def:concrete_category} and locally small\Tinyref{def:category_cardinality}.
\end{definition}

\begin{definition}\label{def:equivalent_metrics}
  Two metrics $\mu$ and $\nu$ on the set $X$ are said to be \ul{equivalent} if $\mu$ and $\nu$ have the same metric topology\Tinyref{def:metric_topology}. They are said to be \ul{strongly equivalent} if there exist constants $\alpha, \beta \in \BB{R}$ such that for every $x, y \in X$ we have
  \begin{align*}
    \alpha \nu(x, y) \leq \mu(x, y) \leq \beta \nu(x, y).
  \end{align*}
\end{definition}

\begin{theorem}\label{thm:real_metric_and_order_topologies_coincide}
  For the real numbers, the metric\Tinyref{def:metric_topology} and order\Tinyref{def:order_topology} topologies coincide.
\end{theorem}
\begin{proof}
  The metric topology $\Cal{T}_M$ is generated by the base\Tinyref{def:topological_base}
  \begin{align*}
    \Cal{B} \coloneqq \{ B(x, r) \colon x \in \BB{R}, r \in \BB{R}^{>0} \}
  \end{align*}
  and the order topology $\Cal{T}_O$ is generated by the subbase\Tinyref{def:topological_subbase}
  \begin{align*}
    \Cal{P} \coloneqq \{ (a, \infty) \colon a \in \BB{R} \} \cup \{ (\infty, b) \colon b \in \BB{R} \}.
  \end{align*}

  The inclusion $\Cal{B} \subseteq FI(\Cal{P})$ is obvious since any ball $B(x, r)$ is the intersection of the two rays
  \begin{align*}
    B(x, r) = (x - r, \infty) \cap (-\infty, x + r).
  \end{align*}

  Thus $\Cal{T}_M \subseteq \Cal{T}_O$. We now only need to show that $\Cal{B}$ is a base for $\Cal{T}_O$.

  Let $U \in \Cal{T}_O$. Since $FI(\Cal{P})$ is a base for $\Cal{T}_O$, there exists\Tinyref{def:topological_base/union} a family $\{ U_i \}_{i \in I} \subseteq FI(\Cal{P})$ such that
  \begin{align*}
    U = \bigcup_{i \in I} U_i.
  \end{align*}

  We only need to express every $U_i$ as a union of balls from $\Cal{B}$. There are several possibilities:
  \begin{itemize}
    \item if $U_i$ is the open interval $(a, \infty)$,
    \begin{align*}
      (a, \infty) = \bigcup_{i=1}^\infty B(a + i, 1).
    \end{align*}

    \item if $U_i$ is the open interval $(-\infty, b)$,
    \begin{align*}
      (-\infty, b) = \bigcup_{i=1}^\infty B(b - i, 1).
    \end{align*}

    \item if $U_i$ is the intersection $(a, \infty) \cap (-\infty, b), a < b$,
    \begin{align*}
      (a, \infty) \cap (-\infty, b) = B(\tfrac {a + b} 2, \tfrac {b - a} 2)
    \end{align*}

    \item if $U_i$ is the empty set,
    \begin{align*}
      \varnothing = \bigcup \varnothing \text{ (see \cref{def:set_union})}.
    \end{align*}
  \end{itemize}

  Thus $U_i$ is the union of an at most countable amount of balls. The countable union of countable sets is again countable, hence by \cref{def:topological_base/union}, $\Cal{B}$ is a base for $\Cal{T}_O$.
\end{proof}

\begin{definition}\label{def:fundamental_sequence}
  Let $(X, \mu)$ be a metric space. We say that the sequence $\{ x_i \}_{i=1}^n \subseteq X$ is a \ul{fundamental sequence} or \ul{Cauchy sequence} if, for any $\varepsilon > 0$, there exists an index $i_0$ such that
  \begin{align*}
    i, j \geq i_0 \implies \mu(x_i, x_j) < \varepsilon.
  \end{align*}
\end{definition}

\begin{proposition}\label{thm:fundamental_sequence_is_bounded}
  Any fundamental sequence $\{ x_i \}_{i=1}^n$ is bounded\Tinyref{def:metric_space/bounded_sequence}.
\end{proposition}
\begin{proof}
  Fix $\varepsilon > 0$. There exists an index $i_0$ such that
  \begin{align*}
    i, j \geq i_0 \implies \mu(x_i, x_j) < \varepsilon.
  \end{align*}

  Since the set
  \begin{align*}
    I \coloneqq \{ x_i \colon i \leq i_0 \}
  \end{align*}
  is finite, it has a finite diameter\Tinyref{def:metric_space/diameter}.

  Let $i < i_0$ and $j \geq i_0$. Then
  \begin{align*}
    \mu(x_i, x_j) \leq \mu(x_i, x_{i_0}) + \mu(x_{i_0}, x_j) < \Diam(I) + \varepsilon,
  \end{align*}
  which is a finite number.

  Thus the distance between any two elements of the sequence is finite and the sequence is bounded.
\end{proof}

\begin{proposition}\label{thm:fundamental_subsequence_convergence}
  In any metric space\Tinyref{def:complete_metric_space}, a fundamental sequence\Tinyref{def:fundamental_sequence} converges to a value if and only if it has a subsequence that converges to the same value.
\end{proposition}
\begin{proof}
  Let $(X, \mu)$ be a metric space and let $\{ x_i \}_{i=1}^\infty$ be a fundamental sequence.

  \begin{description}
    \Implies Obvious
    \ImpliedBy Assume that the subsequence $\{ x_{i_k} \}_{k=1}^\infty$ converges to $x$. Fix $\varepsilon > 0$. There exist $i_0$ and $k_0$ such that
    \begin{align*}
      &i, j \geq i_0 \implies \mu(x_i, x_j) < \tfrac \varepsilon 2 \\
      &k \geq k_0 \implies \mu(x, x_{i_k}) < \tfrac \varepsilon 2
    \end{align*}

    Fix $i \geq i_0$ and let $k \geq k_0$ be such that $i_k \geq i_0$. Then
    \begin{align*}
      \mu(x, x_i) \leq \mu(x, x_{i_k}) + \mu(x_{i_k}, x_i) < \varepsilon.
    \end{align*}

    Since $\varepsilon$ was arbitrary, we conclude that $\lim_{i \to \infty} x_i = \lim_{k \to \infty} x_{i_k} = x$.
  \end{description}
\end{proof}

\begin{definition}\label{def:complete_metric_space}
  We say that a metric space is \ul{complete} if every fundamental sequence\Tinyref{def:fundamental_sequence} has a limit\Tinyref{thm:metric_convergence_iff_metric_topology_convergence/limit_point}.
\end{definition}

\begin{proposition}\label{thm:convergent_sequence_is_fundamental}
  In a complete metric space\Tinyref{def:complete_metric_space}, every convergent\Tinyref{def:net_limit_point}\Tinyref{thm:metric_convergence_iff_metric_topology_convergence/limit_point} sequence is fundamental\Tinyref{def:fundamental_sequence}.
\end{proposition}
\begin{proof}
  Let $(X, \mu)$ be a complete metric space and $\{ x_i \}_{i=1}^\infty$ be a sequence that converges to $x$. Fix $\varepsilon > 0$. Then there exists an index $i_0$ such that
  \begin{align*}
    i \geq i_0 \implies \mu(x, x_i) < \tfrac \varepsilon 2.
  \end{align*}

  Then
  \begin{align*}
    i, j \geq i_0 \implies \mu(x_i, x_j) \leq \mu(x_i, x) + \mu(x, x_j) < \tfrac \varepsilon 2 + \tfrac \varepsilon 2 = \varepsilon.
  \end{align*}

  Since $\varepsilon > 0$ was arbitrary, we conclude that the sequence is fundamental.
\end{proof}

\begin{corollary}[Cauchy convergence criterion]\label{thm:cauchy_convergence_criterion}
  A sequence in a complete metric space is convergent\Tinyref{def:net_limit_point}\Tinyref{thm:metric_convergence_iff_metric_topology_convergence/limit_point} if and only if it is a fundamental sequence\Tinyref{def:fundamental_sequence}.
\end{corollary}
\begin{proof}
  \Implies Given by \cref{thm:convergent_sequence_is_fundamental}
  \ImpliedBy Given by \cref{def:complete_metric_space}
\end{proof}

\begin{theorem}[Cantor]\label{thm:cantor_nested_compacts}
  A descending sequence of nonempty compact sets $F_1 \supseteq F_2 \supseteq \ldots$ in a complete metric space such that $\Diam(F_i) \to 0$ intersects at exactly one point (compare with \cref{thm:noncompact_kuratowski_lemma}).
\end{theorem}
\begin{proof}
  Choose\AOC an element $x_i \in F_i$ for any $i = 1, 2, \ldots$. Then the sequence $\{ x_i \}_{i=1}^\infty$ is fundamental. To see this, let $\varepsilon > 0$ and let $i_0$ be an index such that $\Diam(F_{i_0}) < \varepsilon$. Then if $j \geq i \geq i_0$, $x_j$ is contained in $F_i$ and $\mu(x_i, x_j) < \varepsilon$. Thus the sequence is indeed fundamental and, since the space is complete, it has a limit point $x$.

  The point $x$ is contained in every set $F_i, i = 1, 2, \ldots$ since all of the sets $F_i$ are closed (by \cref{thm:complete_metric_space_compact_conditions}) and contain their limit points\Tinyref{thm:limit_point_iff_in_closure}. Thus
  \begin{align*}
    x \in \bigcap_{i=1}^\infty F_i.
  \end{align*}

  Furthermore,
  \begin{align*}
    \Diam\left( \bigcap_{i=1}^\infty F_i \right) = 0,
  \end{align*}
  hence $x$ is the only point in the intersection.
\end{proof}
