\section{Metric spaces}\label{sec:metric_spaces}
\subsection{Metric spaces}\label{subsec:metric_spaces}

\begin{definition}\label{def:metric_space}\cite[248]{Engelking1989}
  A \Def{metric space} is a set \( X \) along with a nonnegative real-valued function \( \rho: X \times X \to [0, \infty) \), called a \Def{metric}, also called the \Def{distance function}, such that
  \begin{defenum}[series=def:metric_space]
    \DItem{def:metric_space/M1}[M1] \( \rho(x, y) = 0 \iff x = y \)
    \DItem{def:metric_space/M2}[M2](symmetry) \( \rho(x, y) = \rho(y, x) \)
    \DItem{def:metric_space/M3}[M3](triangle inequality) \( \rho(x, y) \leq \rho(x, z) + \rho(z, y) \)
  \end{defenum}

  If instead of \ref{def:metric_space/M1} we have the weaker condition
  \begin{defenum}[resume=def:metric_space]
    \DItem{def:metric_space/pseudometric_identity}[M1'] \( \forall x \in X, \rho(x, x) = 0 \),
  \end{defenum}
  we call \( \rho \) a \Def{pseudometric} and \( (X, \rho) \) a \Def{pseudometric space}.

  \begin{defenum}
    \DItem{def:metric_space/subspace} If \( A \subseteq X \) is a set, then the restriction \( (A, \rho{\restriction_A}) \) is a metric space and it is called a \Def{subspace} of $X$.

    \DItem{def:metric_space/ball} Define the function
    \begin{align*}
      &B: X \times (0, \infty) \to \Pow(X), \\
      &B(x, r) \coloneqq \{ y \in X \colon \rho(x, y) < r \}.
    \end{align*}

    The set \( B(x, r) \) is called an \Def{open ball} or simply \Def{ball} with \Def{center} \( x \) and \Def{radius} \( r \).

    The ball \( B = B(0, 1) \) is called the \Def{unit ball}.

    \DItem{def:metric_space/closed_ball} The set
    \begin{equation*}
      \Ol{B(x, r)} \coloneqq \Cl(B(x, r))
    \end{equation*}
    is called the \Def{closed ball} with center \( x \) and radius \( r \).

    \DItem{def:metric_space/sphere} The set
    \begin{equation*}
      S(x, r) \coloneqq \Bd{B(x, r)}
    \end{equation*}
    is called the \Def{sphere} with center \( x \) and radius \( r \).

    \DItem{def:metric_space/bounded_set} A set \( A \subseteq X \) is called \Def{bounded} if it is contained in some ball \( B(x, r) \).

    \DItem{def:metric_space/bounded_sequence} A sequence\Tinyref{def:sequence} \( \{ x_k \}_{k=1}^\infty \subseteq X \) is called \Def{bounded} if the corresponding set \( \{ x_k \colon k = 1, 2, \ldots \} \) is bounded\Tinyref{def:metric_space/bounded_set}.

    \DItem{def:metric_space/bounded_metric} If every set is bounded, we say that the metric itself is bounded.

    \DItem{def:metric_space/bounded_function} We say that a function \( f: S \to X \) from a set \( S \) to a metric space \( (X, \rho) \) is \Def{bounded} if its image \( f(S) \) is a bounded set in \( (X, \rho) \).

    \DItem{def:metric_space/diameter} Define the function
    \begin{align*}
      &\Diam: \Pow(X) \to [0, \infty], \\
      &\Diam(A) \coloneqq \sup \{ \rho(x, y) \colon x, y \in A \},
    \end{align*}
    whose values include the nonnegative extended real numbers\Tinyref{def:extended_real_numbers}.

    If it exists, we call the number \( \Diam(A) \) the \Def{diameter of \( A \)}.

    \DItem{def:metric_space/distance} Define the function
    \begin{align*}
      &\Dist: X \times \Pow(X) \to [0, \infty), \\
      &\Dist(x, A) \coloneqq \inf \{ \rho(x, a) \colon a \in A \}.
    \end{align*}

    We call the number \( \Dist(x, A) \) the \Def{distance from the point \( x \) to the set \( A \)}. We use the convention that the infimum of an empty set of real numbers is \( +\infty \), hence \( \Dist(x, \varnothing) = \infty \).
  \end{defenum}
\end{definition}

\begin{proposition}\label{thm:pseudometric_to_metric}
  Let \( (X, \rho) \) be a pseudometric space\Tinyref{def:metric_space}. Define the equivalence relation
  \begin{equation*}
    x \cong y \iff \rho(x, y) = 0.
  \end{equation*}

  Then the following metric on the quotient set\Tinyref{thm:equivalence_partition} \( M \coloneqq X / \cong \)
  \begin{align*}
    &\rho: M \times M \to [0, \infty) \\
    &\rho([x], [y]) \coloneqq \rho(x, y)
  \end{align*}
  is well defined.
\end{proposition}
\begin{proof}
  The function \( \rho \) is well defined since, if \( x \) and \( y \) both belong to the same equivalence class \( [x] \), then \( \rho(x) = \rho(y) \). Thus \( \rho \) does not depend on the choice of representatives.

  Additionally, \( \rho \) is a metric since \( \rho([x], [y]) = 0 \) implies that \( [x] = [y] \), that is, \( \rho(x, y) = 0 \).
\end{proof}

\begin{proposition}\label{remark:bounded_set_metric_order_equivalence}
  A set \( A \) in a metric space \( (X, \rho) \) is bounded\Tinyref{def:metric_space/bounded_set} if and only if the set \( \{ \rho(a, b) \colon a, b \in A \} \) is bounded as a poset\Tinyref{def:preordered_set/bounded_set}.
\end{proposition}

\begin{definition}\label{def:metric_topology}\cite[249]{Engelking1989}
  Let \( (X, \rho) \) be a metric space. We define the \Def{metric topology}\( \CT \) , also called the \Def{induced topology}, as the topology\Tinyref{def:topological_space} generated by the neighborhood system\Tinyref{def:topological_local_base}
  \begin{equation}\label{def:metric_topology/integer_base}
    \Cal{B}(x) \coloneqq \{ B(x, \tfrac 1 n) \colon n = 1, 2, 3, \ldots \}.
  \end{equation}

  If for some topological space \( (X, \CT) \) there exists a metric such that \( \CT \) is its induced topology, we say that the topology \( \CT \) is \Def{metrizable}.

  It is often conventional to consider the alternative (larger) base
  \begin{equation}\label{def:metric_topology/real_base}
    \Cal{B}'(x) \coloneqq \{ B(x, \varepsilon) \colon \varepsilon > 0 \}.
  \end{equation}
\end{definition}
\begin{proof}
  This is indeed a neighborhood system as it satisfies \fullref{thm:topological_local_base_axioms/BP1}-\fullref{thm:topological_local_base_axioms/BP3}:

  \begin{description}
    \RItem{thm:topological_local_base_axioms/BP1} Every point \( x \) belongs to any ball centered at \( x \).

    \RItem{thm:topological_local_base_axioms/BP2} Fix \( x \in X \) and two balls \( B(x, \tfrac 1 n) \) and \( B(x, \tfrac 1 m) \). Then
    \begin{equation*}
      B(x, \tfrac 1 {\max\{ n, m \}}) \subseteq B(x, n) \cap B(x, m).
    \end{equation*}

    \RItem{thm:topological_local_base_axioms/BP3} Fix \( x, y \in X \) and let \( x \in B(y, \tfrac 1 n) \), i.e. \( \rho(x, y) < \tfrac 1 n \).

    \begin{figure}\label{def:metric_topology/nested_balls}
      \centering
      \begin{mplibcode}
        u := 1cm;
        r := sqrt(2) / 2;

        pair v;
        v := (1, 1);

        beginfig(1);
          draw fullcircle scaled 3u;
          dotlabel.bot("$y$", origin);

          draw fullcircle scaled 1u shifted (-r * u * v);
          dotlabel.bot("$x_1$", -r * u * v);

          draw fullcircle scaled 1u shifted (r/2 * u * v);
          dotlabel.bot("$x_2$", r/2 * u * v);
        endfig;
      \end{mplibcode}
      \caption{There is a nested ball around every point in an open ball}
    \end{figure}

    Define \( m \) to be the the smallest positive integer such that
    \begin{equation*}
      \tfrac 1 m \leq \min\{ \rho(x, \tfrac 1 n), \tfrac 1 n - \rho(x, \tfrac 1 n) \}.
    \end{equation*}

    Note that \( m \) exists by \fullref{thm:ordinals_are_well_ordered}.

    Let \( z \in B(x, \tfrac 1 m) \). There are two cases:
    \begin{itemize}
      \item If \( \rho(x, y) \leq \tfrac 1 {2n} \), then
      \begin{align*}
        \rho(z, y)
        \leq
        \rho(z, x) + \rho(x, y)
        <
        \tfrac 1 m + \rho(x, y)
        \leq
        \tfrac 1 n + \tfrac 1 n
        \leq
        2 \tfrac 1 {2n}
        =
        \tfrac 1 n.
      \end{align*}

      \item If \( \rho(x, y) > \tfrac 1 {2n} \), then
      \begin{align*}
        \rho(z, y)
        \leq
        \rho(z, x) + \rho(x, y)
        <
        \tfrac 1 m + \rho(x, y)
        \leq
        (\tfrac 1 n - \rho(x, y)) + \rho(x, y)
        =
        \tfrac 1 n.
      \end{align*}
    \end{itemize}

    In both cases, \( B(x, \tfrac 1 m) \subseteq B(y, \tfrac 1 n) \).
  \end{description}
\end{proof}

\begin{proposition}\label{thm:metric_topology_properties}
  The metric topology \( \CT \) on \( X \) induced by \( \rho \) has the following properties:
  \begin{defenum}
    \DItem{thm:metric_topology_properties/ball_is_open} For every point \( x \in X \) and any radius \( r > 0 \), the ball \( B(x, r) \) is an open set and, hence, a neighborhood of \( x \).
    \DItem{thm:metric_topology_properties/first_countable} \( \CT \) is first-countable.
    \DItem{thm:metric_topology_properties/sequential} \( \CT \) is sequential.
    \DItem{thm:metric_topology_properties/hausdorff} \( \CT \) is Hausdorff.
  \end{defenum}
\end{proposition}
\begin{proof}\mbox{}
  \begin{description}
    \RItem{thm:metric_topology_properties/ball_is_open} Obvious from \fullref{def:metric_topology}.

    \RItem{thm:metric_topology_properties/first_countable} Since \fullref{def:metric_topology} involves generating a topology using a neighborhood system of countable local neighborhoods, \( \CT \) is first-countable.

    \RItem{thm:metric_topology_properties/sequential} Follows from \fullref{thm:metric_topology_properties/first_countable} and \fullref{thm:first_countable_spaces_are_sequential}.

    \RItem{thm:metric_topology_properties/hausdorff} Let \( x, y \in X \) be distinct points. Define
    \begin{equation*}
      r \coloneqq \dfrac 1 2 \rho(x, y),
    \end{equation*}
    so that
    \begin{equation*}
      B(x, r) \cap B(y, r) = \varnothing.
    \end{equation*}
  \end{description}
\end{proof}

\begin{definition}\label{def:metric_uniformity}
  Let \( (X, \rho) \) be a metric space.

  We define the \Def{metric uniformity} \( \CV \), also called the \Def{induced uniformity}, as the uniformity\Tinyref{def:uniform_space} generated by the countable base\Tinyref{thm:uniform_space_base_axioms}
  \begin{equation}\label{def:metric_uniformity/integer_base}
    \Cal{B} \coloneqq \{ V_n \colon n = 1, 2, \ldots \},
  \end{equation}
  where
  \begin{equation*}
    V_n \coloneqq \rho^{-1}([0, \tfrac 1 n)).
  \end{equation*}

  As for the metric topology\Tinyref{def:metric_topology}, we can instead consider the base
  \begin{equation}\label{def:metric_uniformity/real_base}
    \Cal{B}' \coloneqq \{ \rho^{-1}([0, \varepsilon)) \colon \varepsilon > 0 \}.
  \end{equation}
\end{definition}
\begin{proof}
  Each relation \( V_r \) is obviously an entourage by \ref{def:metric_space/M1} and \ref{def:metric_space/M2}. We will prove that \( \Cal{B} \) is indeed a uniform space base.

  \begin{description}
    \RItem{thm:uniform_space_base_axioms/BU1} For nonnegative integers \( n, m \) we have
    \begin{equation*}
      V_n \cap V_m
      =
      \{ (x, y) \in X \times X \colon \rho(x, y) < \tfrac 1 n \Tand \rho(x, y) < \tfrac 1 m \}
      =
      V_{\max\{ n, m \}}.
    \end{equation*}

    Pick any integer \( k \geq \max\{ n, m \} \) so that
    \begin{equation*}
      V_k \subseteq V_n \cap V_m.
    \end{equation*}

    \RItem{thm:uniform_space_base_axioms/BU2} Fix \( V_n \in \CV \) and \( m \coloneqq 2n \). By the triangle inequality, we have that if \( \rho(x, y) < m \) and \( \rho(y, z) < m \), then
    \begin{equation*}
       \rho(x, z) \leq \rho(x, y) + \rho(y, z) < \tfrac 1 m + \tfrac 1 m = \tfrac 1 n.
    \end{equation*}

    Thus
    \begin{equation*}
      V_m + V_m
      =
      \left\{ (x, z) \colon \exists y \in X: \rho(x, y) < \tfrac 1 m \Tand \rho(y, z) < \tfrac 1 m \right\}
      \subseteq
      V_n
    \end{equation*}

    \RItem{thm:uniform_space_base_axioms/BU3} \ref{def:metric_space/M1} implies that
    \begin{equation*}
      \bigcap \CB = \lim_{n \to \infty} \rho^{-1}([0, \tfrac 1 n)) = \Delta_X.
    \end{equation*}
  \end{description}
\end{proof}

\begin{proposition}\label{thm:metric_topology_coincides_with_uniform_topology}
  The metric topology\Tinyref{def:metric_topology} and the uniform topology\Tinyref{def:uniform_topology} from the metric uniformity\Tinyref{def:metric_uniformity} coincide.
\end{proposition}

\begin{theorem}\label{thm:countable_uniform_base_implies_metrizable}\cite[theorem 8.1.21]{Engelking1989}
  A uniform space \( X \) is metrizable if and only \( w(X) \leq \aleph_0 \).
\end{theorem}

\begin{definition}\label{def:isometry}\cite[253]{Engelking1989}
  Let \( (X, \rho) \) and \( (Y, \nu) \) be two metric spaces\Tinyref{def:metric_space}. We say that the function \( f: X \to Y \) is a \Def{distance preserving map} or \Def{isometry} or \Def{isometric embedding} if
  \begin{equation*}
    \forall x, y \in X, \rho(x, y) = \nu(f(x), f(y)).
  \end{equation*}

  If \( f \) is bijective, we say that \( X \) and \( Y \) are \Def{isometric}.
\end{definition}

\begin{proposition}\label{def:isometry_is_injective}
  An isometry\Tinyref{def:isometry} \( f: (X, \rho) \to (Y, \nu) \) is always injective.
\end{proposition}
\begin{proof}
  If\LEM \( f(x) = f(x') \), then by \fullref{def:metric_space/M1}, \( x = x' \).
\end{proof}

\begin{definition}\label{def:category_of_metric_spaces}
  Metric spaces and monotone maps form a subcategory of \( \Cat{Unif} \) (see \fullref{def:category_of_uniform_spaces}). We denote this category by \( \Cat{Met} \).
\end{definition}

\begin{definition}\label{def:equivalent_metrics}
  Two metrics \( \rho \) and \( \nu \) on the set \( X \) are said to be \Def{equivalent} if \( \rho \) and \( \nu \) have the same metric topology\Tinyref{def:metric_topology}. They are said to be \Def{strongly equivalent} if there exist constants \( \alpha, \beta \in \BR \) such that for every \( x, y \in X \) we have
  \begin{equation*}
    \alpha \nu(x, y) \leq \rho(x, y) \leq \beta \nu(x, y).
  \end{equation*}
\end{definition}

\begin{remark}\label{remark:metric_space_convergence}
  All types of convergence from \fullref{subsec:topological_nets}, \fullref{subsec:topological_continuity} and \fullref{subsec:uniform_spaces} hold in metric spaces using the metric topology\Tinyref{def:metric_topology} and metric uniformity\Tinyref{def:metric_uniformity} structure.

  It is conventional to prefer the bases \fullref{def:metric_topology/real_base} and \fullref{def:metric_uniformity/real_base} to the bases \fullref{def:metric_topology/integer_base} and \fullref{def:metric_topology/integer_base}.

  For example, given two metric spaces \( X \) and \( Y \), continuity of \( f: X \to Y \) at \( x_0 \in X \) (see \fullref{def:local_continuity}) is usually written using the \enquote{epsilon-delta notation} as
  \begin{equation*}
    \forall \varepsilon > 0 \ \exists \delta > 0 : \rho_X(x, x_0) < \delta \implies \rho_Y(f(x), f(x_0)) < \varepsilon
  \end{equation*}
  for any \( x \in X \).
\end{remark}
